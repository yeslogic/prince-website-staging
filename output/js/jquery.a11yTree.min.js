/*! jquery.a11yTree */

!function(a,b,c,d){function e(b,c){this.element=b,this.treeIdPiece=this.element.id?"-"+this.element.id:"",this.options=a.extend({},g,c),this.init()}function f(a,b){return a.which===b}var g={treeLabelId:void 0,treeItemLabelSelector:void 0,toggleSelector:void 0,insertToggle:!0,customToggle:{html:void 0},onExpand:function(){},onCollapse:function(){},markEntryActiveOnScroll:!0};e.prototype={init:function(){var b=a(this.element);this.identifyChildren(b,"tree",1),this.addTreeLabels(b),this.attachToggle(b),this.addMouseNav(b),this.addKeyBoardNav(b),this.highlightByUrlAndFragment(b,location.pathname,location.hash),this.options.markEntryActiveOnScroll&&this.initMarkActiveOnScroll(b,location.pathname)},addIdToTreeLabels:function(b){var c=this,d=c.options.treeItemLabelSelector;if(d){b.find(".at-has-children").each(function(){var b=a(this),c=b.children(d).attr("id");c&&b.children("ul").attr("aria-labelledby",c)})}},addTreeLabels:function(b){var c=this,d=c.options.treeLabelId;d&&a("#"+d).length>0&&b.attr("aria-labelledby",d),c.addIdToTreeLabels(b)},attachToggle:function(a){if(!1!==this.options.insertToggle){if(this.options.toggleSelector)a.find(this.options.toggleSelector).addClass("at-toggle").attr("aria-hidden","true");else{var b="";this.options.customToggle.html&&(b=this.options.customToggle.html),a.find(".at-has-children").prepend('<div class="at-toggle" aria-hidden="true">'+b+"</div>")}this.attachToggleClick(a)}},attachToggleClick:function(b){var c=this;b.find(".at-toggle").on("click",function(b){var d=a(this).parent("li");c.toggleExpandCollapse(d,b)})},addMouseNav:function(b){var c=this;b.find("li").click(function(d){d.stopPropagation(),c.focusOn(a(this),b)})},addKeyBoardNav:function(a){this.focusOn(this.findFirstListItem(a),a),this.addTreeToTabOrder(a),this.handleKeys(a)},handleKeys:function(a){var b=this;a.on("keydown",function(c){var d=a.find('[aria-selected="true"]');f(c,40)?(c.preventDefault(),b.handleDownArrowKey(d,a)):f(c,38)?(c.preventDefault(),b.handleUpArrowKey(d,a)):f(c,39)?(c.preventDefault(),b.handleRightArrowKey(d,a,c)):f(c,37)?(c.preventDefault(),b.handleLeftArrowKey(d,a,c)):f(c,13)?b.handleEnterKey(d,c):f(c,35)?(c.preventDefault(),b.handleEndKey(d,a)):f(c,36)&&(c.preventDefault(),b.handleHomeKey(d,a))})},addTreeToTabOrder:function(a){a.attr("tabindex","0")},handleLeftArrowKey:function(a,b,c){this.isExpanded(a)?this.collapse(a,c):this.focusOn(this.findParent(a),b)},handleRightArrowKey:function(a,b,c){this.isCollapsed(a)?this.expand(a,c):this.isExpanded(a)&&this.focusOn(this.findFirstListItemInSubList(a),b)},handleUpArrowKey:function(a,b){var c=a.prev();this.isExpanded(c)?this.focusOnLastVisibleElementInTree(c.children("ul"),b):0===a.prev().length?this.focusOn(this.findParent(a),b):this.focusOn(a.prev(),b)},handleDownArrowKey:function(a,b){this.hasChildren(a)&&this.isExpanded(a)?this.focusOn(this.findFirstListItemInSubList(a),b):this.focusOnNextAvailableSiblingInTree(a,b)},handleEnterKey:function(a,b){this.toggleExpandCollapse(a,b)},handleEndKey:function(a,b){this.focusOnLastVisibleElementInTree(b)},handleHomeKey:function(a,b){this.focusOn(this.findFirstListItem(b),b)},hasChildren:function(a){return a.hasClass("at-has-children")},focusOn:function(a,b){1===a.length&&(b.find("li").attr("aria-selected","false"),a.attr("aria-selected","true"),b.attr("aria-activedescendant",a.attr("id")))},focusOnNextAvailableSiblingInTree:function(a,b){0!==a.length&&(a.next().length>0?this.focusOn(a.next(),b):this.focusOnNextAvailableSiblingInTree(this.findParent(a),b))},focusOnLastVisibleElementInTree:function(a,b){var c=a.find("li").last(),d=c.parent("ul");this.isParentTree(d)||(d=this.findClosestExpandedTree(a,c)),this.focusOn(this.findLastListItem(d),b||a)},findClosestExpandedTree:function(a,b){var c=b.parent("ul").closest('li[aria-expanded="true"]');if(0===c.length)return a;var d=c.parent("ul").closest("li");return 0===d.length||this.isExpanded(d)?c.children("ul"):this.findClosestExpandedTree(a,c)},expand:function(a,b){this.options.onExpand&&this.options.onExpand(a,b),a.attr("aria-expanded","true")},collapse:function(a,b){this.options.onCollapse&&this.options.onCollapse(a,b),a.attr("aria-expanded","false")},isExpanded:function(a){return"true"===a.attr("aria-expanded")},isCollapsed:function(a){return"false"===a.attr("aria-expanded")},toggleExpandCollapse:function(a,b){this.isCollapsed(a)?this.expand(a,b):this.collapse(a,b)},isParentTree:function(a){return"tree"===a.attr("role")},findParent:function(a){return a.parent("ul").parent("li")},findLastListItem:function(a){return a.find(" > li:last-child")},findFirstListItem:function(a){return a.find(" > li:first-child")},findFirstListItemInSubList:function(a){return a.children("ul").find(" > li:first-child")},identifyListItemWithChildren:function(a){this.collapse(a),a.addClass("at-has-children")},identifySubChildren:function(a,b,c){var d=a.children("ul");d.length>0?(this.identifyListItemWithChildren(a),this.identifyChildren(d,"group",c+1,b)):a.addClass("at-no-children")},identifyChildren:function(b,c,d){var e=this;b.attr("role",c);var f=b.children("li");f.attr("role","treeitem").attr("aria-level",d),f.each(function(){e.addIdToListItem(a(this),b,d),e.identifySubChildren(a(this),b,d)})},addIdToListItem:function(a,b){var c=this.generateListItemId(a,b);this.addIdAsDataOrId(a,c)},addIdAsDataOrId:function(a,b){var c=a.attr("id"),d=b;c?(d=c,a.data("at-identity",b)):a.attr("id",b),this.addIdToNodeLabel(a,d)},addIdToNodeLabel:function(a,b){var c=this.options.treeItemLabelSelector;if(c){var d=a.children(c);d.attr("id")||d.attr("id",b+"-label")}},generateListItemId:function(a,b){return(0===b.parent("li").length?"at"+this.treeIdPiece+"-n":a.data("at-identity")||b.parent("li").attr("id"))+"-"+b.children("li").index(a)},highlightByUrlAndFragment:function(a,b,c){var d=a.find('a[href*="'+b+c+'"]:first');1===d.length&&(this.expand(d.parents("li")),this.focusOn(d.closest("li"),a))},initMarkActiveOnScroll:function(b,d){var e=this,f=[],g=[];b.find('a[href*="'+d+'"]').each(function(){var b=this,d=b.hash,e=a(d)||a(c).find('a[name="'+d.substr(1)+'"]');if(e.length){f.push({elm:e,link:b,initialOffset:e.offset().top});var h=e.scrollParent();-1===g.indexOf(h)&&g.push(h)}}),f=f.sort(function(a,b){return a.initialOffset<b.initialOffset}),g.forEach(function(c){var g=0;a(c).scroll(function(a){var c=a.target.scrollTop;if(!(Math.max(c,g)-Math.min(c,g)<100)){g=c;for(var h=0;h<f.length;h++)if(f[h].elm.offset().top<150){e.highlightByUrlAndFragment(b,d,f[h].link.hash);break}}})})}},a.fn.a11yTree=function(b){return this.each(function(){a.data(this,"plugin_a11yTree")||a.data(this,"plugin_a11yTree",new e(this,b))})}}(jQuery,window,document);